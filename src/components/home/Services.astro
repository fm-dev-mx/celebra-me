---
// /src/sections/Services.astro
// This component displays the services offered, utilizing the Prime design system.

import Container from '@components/layout/Container.astro';
import Section from '@components/layout/Section.astro';
import OptimizedImage from '@components/common/OptimizedImage.astro';
// Import the robust Icon component that uses SVG paths
import Icon from '@components/common/icons/AppIcon.astro';

// Import local images
import xvImage from '@images/services/xv.png';
import weddingImage from '@images/services/wedding.png';
import baptismImage from '@images/services/baptism.png';

import type { ServicesData } from '@/interfaces/ui/sections/landing-page.interface';

// Import stylesheet
import '@/styles/home/_services.scss';

interface Props {
	data: ServicesData;
}

const { data } = Astro.props;

// Map images to services order
// Assumes order: XV Años, Bodas, Bautizos based on data in index.astro
const serviceImages = [xvImage, weddingImage, baptismImage];

// Helper to generate slug for links
const getServiceLink = (title: string) => {
	const slug = title.toLowerCase()
		.replace(/ñ/g, 'n')
		.replace(/\s+/g, '-')
		.normalize('NFD').replace(/[\u0300-\u036f]/g, ''); // Remove accents
	return `/${slug}`;
};
---

<Section id="services" class="services section-padding">
	<Container class="services__container">
		<header class="services__header">
			<h2 class="services__heading">{data.title}</h2>
		</header>

		<div class="services__grid">
			{
				data.services.map((service, index) => {
                    const image = serviceImages[index] || serviceImages[0];
                    const href = getServiceLink(service.title);
					// Calculate delay for staggered animation: 0ms, 200ms, 400ms
					const delay = `${index * 200}ms`;

                    return (
					<a href={href} class="services__card" style={`--animation-delay: ${delay}`} aria-label={`Ver detalles del servicio ${service.title}`}>
						<div class="services__card-visual">
							<div class="services__image-wrapper">
								<OptimizedImage
									imagePath={image}
									alt={`Servicio de ${service.title}`}
									width={600}
									height={800}
									class="services__image"
								/>
							</div>
							<div class="services__overlay"></div>
						</div>

						<div class="services__content">
							<div class="services__icon-wrapper">
								<Icon name={service.icon || 'StarIcon'} class="services__icon" />
							</div>

							<h3 class="services__title">{service.title}</h3>
							<p class="services__description">{service.description}</p>

							<span class="services__cta">
								Ver Ejemplos
								<Icon name="ArrowRight" class="services__cta-icon" />
							</span>
						</div>
					</a>
				)})
			}
		</div>
	</Container>
</Section>

<script>
	// IntersectionObserver for staggered entrance animations
	const observerOptions = {
		root: null,
		rootMargin: '0px',
		threshold: 0.15
	};

	const observer = new IntersectionObserver((entries) => {
		entries.forEach((entry) => {
			if (entry.isIntersecting) {
				entry.target.classList.add('is-visible');
				observer.unobserve(entry.target);
			}
		});
	}, observerOptions);

	const cards = document.querySelectorAll('.services__card');
	cards.forEach((card) => {
		observer.observe(card);
	});
</script>
