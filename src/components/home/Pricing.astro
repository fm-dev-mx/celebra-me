---
// src/components/home/Pricing.astro
import type { PricingData } from '@/interfaces/ui/sections/landing-page.interface';

interface Props {
	data: PricingData;
}

const { data } = Astro.props;
---

<section id="pricing" class="pricing-section">
	<div class="pricing-noise"></div>

	<div class="container">
		<header class="pricing-header">
			<span class="pricing-pretitle">Inversión para tu gran día</span>
			<h2 class="pricing-title">{data.title}</h2>
			<p class="pricing-subtitle">
				Selecciona la experiencia que mejor se adapte a tu celebración.
			</p>
		</header>

		<div class="pricing-grid">
			{
				data.tiers.map((tier, index) => {
					const isPremium = tier.title === 'Premium';
					const isElite = tier.isElite;

					return (
						<article
							class:list={[
								'pricing-card',
								{ 'is-premium': isPremium },
								{ 'is-elite': isElite }
							]}
							data-index={index}
						>
							{isPremium && <div class="premium-badge">MÁS ELEGIDO</div>}

							<div class="card-content">
								<h3 class="tier-name">{tier.title}</h3>
								<p class="tier-desc">{tier.description}</p>

								<div class="tier-price">
									{tier.price.amount !== 'Consultar' && <span class="currency-symbol">$</span>}
									<span class="amount">{tier.price.amount}</span>
									{tier.price.currency && <span class="currency-code">{tier.price.currency}</span>}
									{tier.price.period && <span class="period">/ {tier.price.period}</span>}
								</div>

								<ul class="feature-list">
									{tier.features.map((feature) => (
										<li class="feature-item" data-feature={feature.toLowerCase().replace(/\s+/g, '-')}>
											<svg viewBox="0 0 20 20" fill="currentColor" class="check-icon" aria-hidden="true">
												<path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
											</svg>
											<span>{feature}</span>
										</li>
									))}
								</ul>

								<a href={tier.href} class="cta-button" aria-label={`Elegir plan ${tier.title}`}>
									<span>{tier.cta}</span>
									<div class="glint" aria-hidden="true"></div>
								</a>
							</div>

							<div class="card-border"></div>
						</article>
					);
				})
			}
		</div>
	</div>
</section>

<script>
	const observerOptions = {
		threshold: 0.1,
		rootMargin: '0px 0px -100px 0px'
	};

	const observer = new IntersectionObserver((entries) => {
		entries.forEach(entry => {
			if (entry.isIntersecting) {
				entry.target.classList.add('is-visible');
				observer.unobserve(entry.target);
			}
		});
	}, observerOptions);

	document.querySelectorAll('.pricing-card').forEach(card => {
		observer.observe(card);
	});

	// Feature row highlighting logic
	const featureItems = document.querySelectorAll('.feature-item');

	featureItems.forEach(item => {
		item.addEventListener('mouseenter', () => {
			const feature = (item as HTMLElement).dataset.feature;
			if (feature) {
				document.querySelectorAll(`.feature-item[data-feature="${feature}"]`).forEach(el => {
					el.classList.add('is-highlighted');
				});
			}
		});

		item.addEventListener('mouseleave', () => {
			const feature = (item as HTMLElement).dataset.feature;
			if (feature) {
				document.querySelectorAll(`.feature-item[data-feature="${feature}"]`).forEach(el => {
					el.classList.remove('is-highlighted');
				});
			}
		});
	});
</script>
