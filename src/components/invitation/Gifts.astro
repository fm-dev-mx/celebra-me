---
// src/components/invitation/Gifts.astro
import '@/styles/invitation/_gifts.scss';

interface GiftStore {
	type: 'store';
	title: string;
	url: string;
	logo?: string;
}

interface GiftBank {
	type: 'bank';
	title: string;
	bankName: string;
	accountHolder: string;
	clabe: string;
	accountNumber?: string;
}

interface GiftPaypal {
	type: 'paypal';
	title: string;
	url: string;
}

interface GiftCash {
	type: 'cash';
	title: string;
	text?: string;
}

type Gift = GiftStore | GiftBank | GiftPaypal | GiftCash;

interface Props {
	gifts: Gift[];
	variant?: string;
	title?: string;
	subtitle?: string;
	labels?: {
		copy?: string;
		copied?: string;
		viewRegistry?: string;
		sendGift?: string;
		bank?: string;
		titular?: string;
		clabe?: string;
	};
}

const {
	gifts,
	variant = 'standard',
	title = 'Mesa de Regalos',
	subtitle = 'Su presencia es nuestro mayor regalo, pero si desean tener un detalle, aquí les compartimos algunas opciones.',
	labels = {
		copy: 'Copiar',
		copied: '¡Copiado!',
		viewRegistry: 'Ver Mesa de Regalos',
		sendGift: 'Enviar Regalo',
		bank: 'Banco',
		titular: 'Titular',
		clabe: 'CLABE',
	},
} = Astro.props;

import { GiftIcon } from '@/components/common/icons/invitation';
import { BankCardIcon, CashIcon } from '@/components/common/icons/ui';
import { PayPalIcon } from '@/components/common/icons/social';

const ICON_MAP = {
	store: GiftIcon,
	bank: BankCardIcon,
	paypal: PayPalIcon,
	cash: CashIcon,
};
---

<section id="regalos" class="gifts-section" data-variant={variant}>
	<div class="gifts-section__container">
		<header class="gifts-section__header">
			<h2 class="gifts-section__title">{title}</h2>
			{subtitle && <p class="gifts-section__subtitle">{subtitle}</p>}
		</header>

		<div class="gifts-grid">
			{
				gifts.map((gift) => {
					const Icon = ICON_MAP[gift.type];
					return (
						<div class={`gift-card gift-card--${gift.type}`}>
							<div class="gift-card__inner">
								<div class="gift-card__icon">
									<Icon size={24} />
								</div>

								<h3 class="gift-card__title">{gift.title}</h3>

								{gift.type === 'store' && (
									<a href={gift.url} target="_blank" rel="noopener noreferrer" class="gift-card__button">
										{labels.viewRegistry}
									</a>
								)}

								{gift.type === 'bank' && (
									<div class="bank-details">
										<p class="bank-details__item"><strong>{labels.bank}:</strong> {gift.bankName}</p>
										<p class="bank-details__item"><strong>{labels.titular}:</strong> {gift.accountHolder}</p>
										<div class="bank-details__clabe-wrapper">
											<p class="bank-details__item"><strong>{labels.clabe}:</strong> <span class="clabe-number">{gift.clabe}</span></p>
											<button class="copy-button" data-clabe={gift.clabe} data-label-copy={labels.copy} data-label-copied={labels.copied} aria-label="Copiar número CLABE">
												{labels.copy}
											</button>
										</div>
									</div>
								)}

								{gift.type === 'paypal' && (
									<a href={gift.url} target="_blank" rel="noopener noreferrer" class="gift-card__button gift-card__button--paypal">
										{labels.sendGift}
									</a>
								)}

								{gift.type === 'cash' && gift.text && (
									<p class="gift-card__description">{gift.text}</p>
								)}
							</div>
						</div>
					);
				})
			}
		</div>
	</div>
</section>

<script>
	const copyButtons = document.querySelectorAll('.copy-button');
	copyButtons.forEach((button) => {
		button.addEventListener('click', () => {
			const clabe = button.getAttribute('data-clabe');
			const labelCopy = button.getAttribute('data-label-copy') || 'Copiar';
			const labelCopied = button.getAttribute('data-label-copied') || '¡Copiado!';

			if (clabe) {
				const normalizedClabe = clabe.replace(/\s+/g, '');
				navigator.clipboard.writeText(normalizedClabe).then(() => {
					button.textContent = labelCopied;
					button.classList.add('copy-button--success');
					setTimeout(() => {
						button.textContent = labelCopy;
						button.classList.remove('copy-button--success');
					}, 2000);
				});
			}
		});
	});
</script>
