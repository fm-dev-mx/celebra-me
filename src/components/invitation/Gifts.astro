---
// src/components/invitation/Gifts.astro
import '@/styles/invitation/_gifts.scss';

interface GiftStore {
	type: 'store';
	name: string;
	url: string;
	logo?: string;
}

interface GiftBank {
	type: 'bank';
	bankName: string;
	accountHolder: string;
	clabe: string;
	accountNumber?: string;
}

interface GiftPaypal {
	type: 'paypal';
	url: string;
}

interface GiftCash {
	type: 'cash';
	text?: string;
}

type Gift = GiftStore | GiftBank | GiftPaypal | GiftCash;

interface Props {
	gifts: Gift[];
	variant?: string;
}

const { gifts, variant = 'standard' } = Astro.props;

import { GiftIcon } from '@/components/common/icons/invitation';
import { BankCardIcon, CashIcon } from '@/components/common/icons/ui';
import { PayPalIcon } from '@/components/common/icons/social';
---

<section id="regalos" class="gifts-section" data-variant={variant}>
	<div class="gifts-section__container">
		<header class="gifts-section__header">
			<h2 class="gifts-section__title">Mesa de Regalos</h2>
			<p class="gifts-section__subtitle">
				Su presencia es nuestro mayor regalo, pero si desean tener un detalle, aquí les compartimos algunas opciones.
			</p>
		</header>

		<div class="gifts-grid">
			{
				gifts.map((gift) => (
					<div class={`gift-card gift-card--${gift.type}`}>
						<div class="gift-card__inner">
							{gift.type === 'store' && (
								<>
									<div class="gift-card__icon">
										<GiftIcon size={24} />
									</div>
									<h3 class="gift-card__title">{gift.name}</h3>
									<a href={gift.url} target="_blank" rel="noopener noreferrer" class="gift-card__button">
										Ver Mesa de Regalos
									</a>
								</>
							)}

							{gift.type === 'bank' && (
								<>
									<div class="gift-card__icon">
										<BankCardIcon size={24} />
									</div>
									<h3 class="gift-card__title">Transferencia</h3>
									<div class="bank-details">
										<p class="bank-details__item">
											<strong>Banco:</strong> {gift.bankName}
										</p>
										<p class="bank-details__item">
											<strong>Titular:</strong> {gift.accountHolder}
										</p>
										<div class="bank-details__clabe-wrapper">
											<p class="bank-details__item">
												<strong>CLABE:</strong> <span class="clabe-number">{gift.clabe}</span>
											</p>
											<button class="copy-button" data-clabe={gift.clabe} aria-label="Copiar número CLABE">
												Copiar
											</button>
										</div>
									</div>
								</>
							)}

							{gift.type === 'paypal' && (
								<>
									<div class="gift-card__icon">
										<PayPalIcon size={24} />
									</div>
									<h3 class="gift-card__title">PayPal</h3>
									<a href={gift.url} target="_blank" rel="noopener noreferrer" class="gift-card__button gift-card__button--paypal">
										Enviar Regalo
									</a>
								</>
							)}

							{gift.type === 'cash' && (
								<>
									<div class="gift-card__icon">
										<CashIcon size={24} />
									</div>
									<h3 class="gift-card__title">Lluvia de Sobres</h3>
									<p class="gift-card__description">
										{gift.text || "Su presencia es nuestro mayor regalo, pero si desean tener un detalle, tendremos un buzón para sobres en la recepción."}
									</p>
								</>
							)}
						</div>
					</div>
				))
			}
		</div>
	</div>
</section>

<script>
	const copyButtons = document.querySelectorAll('.copy-button');
	copyButtons.forEach(button => {
		button.addEventListener('click', () => {
			const clabe = button.getAttribute('data-clabe');
			if (clabe) {
				const normalizedClabe = clabe.replace(/\s+/g, '');
				navigator.clipboard.writeText(normalizedClabe).then(() => {
					const originalText = button.textContent;
					button.textContent = '¡Copiado!';
					button.classList.add('copy-button--success');
					setTimeout(() => {
						button.textContent = originalText;
						button.classList.remove('copy-button--success');
					}, 2000);
				});
			}
		});
	});
</script>
